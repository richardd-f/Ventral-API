generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------- ENUMS -----------------

enum UserVerificationStatus {
  VERIFIED
  REJECTED
}

enum EventStatus {
  OPEN
  CLOSED
  SUSPENDED
}

// -------------- MODELS -----------------

model User {
  user_id            String               @id @default(cuid())
  name               String
  email              String               @unique
  password           String
  phone              String
  bio                String
  img_url            String
  date_of_birth      DateTime
  current_education  String
  isAdmin            Boolean              @default(false)

  events             Event[]              @relation("UserEvents")
  comments           Comment[]
  eventLikes         EventLike[]
  eventDislikes      EventDislike[]
  applications       Application[]
  userVerifications  UserVerification[]
  following          UserFollow[]         @relation("UserFollowing")
  followers          UserFollow[]         @relation("UserFollowers")
  categoryFollows    UserCategoryFollow[]
}

model UserFollow {
  id         String @id @default(cuid())
  subject_id String
  object_id  String

  subject User @relation("UserFollowing", fields: [subject_id], references: [user_id], onDelete: Cascade)
  object  User @relation("UserFollowers", fields: [object_id], references: [user_id], onDelete: Cascade)
}

model UserVerification {
  id                  String @id @default(cuid())
  user_id             String
  identity_url        String?
  full_name           String?
  date_of_birth       DateTime?
  address             String?
  residential_address String?
  status              UserVerificationStatus

  user User @relation(fields: [user_id], references: [user_id])
}

model Application {
  application_id String   @id @default(cuid())
  user_id        String
  event_id       String
  timestamp      DateTime @default(now())

  user  User  @relation(fields: [user_id], references: [user_id])
  event Event @relation(fields: [event_id], references: [event_id])
}

model Comment {
  id       String  @id @default(cuid())
  event_id String
  user_id  String
  content  String

  user  User  @relation(fields: [user_id], references: [user_id])
  event Event @relation(fields: [event_id], references: [event_id])
}

model EventLike {
  id       String @id @default(cuid())
  user_id  String
  event_id String

  user  User  @relation(fields: [user_id], references: [user_id])
  event Event @relation(fields: [event_id], references: [event_id])
}

model EventDislike {
  id       String @id @default(cuid())
  user_id  String
  event_id String

  user  User  @relation(fields: [user_id], references: [user_id])
  event Event @relation(fields: [event_id], references: [event_id])
}

model Event {
  event_id    String   @id @default(cuid())
  author_id   String
  name        String   @unique
  date_start  DateTime
  date_end    DateTime
  description String?
  price       Int?
  status      EventStatus
  quota       Int?

  author       User           @relation("UserEvents", fields: [author_id], references: [user_id])
  comments     Comment[]
  likes        EventLike[]
  dislikes     EventDislike[]
  applications Application[]
  images       ImageEvent[]
  categories   EventCategory[]
}

model ImageEvent {
  imageEvent_id String @id @default(cuid())
  event_id      String
  img_url       String

  event Event @relation(fields: [event_id], references: [event_id])
}

model Category {
  category_id String  @id @default(cuid())
  category    String  @unique

  eventCategories EventCategory[]
  userFollows     UserCategoryFollow[]
}

model EventCategory {
  id          String @id @default(cuid())
  event_id    String
  category_id String

  event    Event    @relation(fields: [event_id], references: [event_id])
  category Category @relation(fields: [category_id], references: [category_id])
}

model UserCategoryFollow {
  id          String @id @default(cuid())
  user_id     String
  category_id String

  user     User     @relation(fields: [user_id], references: [user_id])
  category Category @relation(fields: [category_id], references: [category_id])
}
